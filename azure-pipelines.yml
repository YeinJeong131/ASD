# Azure Pipelines configuration for Java (Gradle) project
# Supports Windows agent, JDK 21, build & test, PR validation

trigger:
  branches:
    include:
      - main
      - build-pipeline
      - code-workflow

pr:
  branches:
    include:
      - main
      - code-workflow

pool:
  vmImage: 'windows-latest'

steps:
  # JDK 21
  - powershell: |
      Write-Host "Using JDK 21"
      Write-Host "##vso[task.setvariable variable=JAVA_HOME]$env:JAVA_HOME_21_X64"
      $env:JAVA_HOME = $env:JAVA_HOME_21_X64
      $env:Path = "$env:JAVA_HOME\bin;" + $env:Path
      java -version
    displayName: 'Select JDK 21 (preinstalled)'

  # Gradle build
  - script: gradlew.bat clean build --no-daemon
    displayName: 'Gradle clean build'

  # Gradle test
  - script: gradlew.bat test --no-daemon
    displayName: 'Run unit tests'

  # upload build artifact
  - task: PublishBuildArtifacts@1
    inputs:
      pathtoPublish: 'build/libs'
      artifactName: 'drop'
      publishLocation: 'Container'
    displayName: 'Publish build artifacts'
